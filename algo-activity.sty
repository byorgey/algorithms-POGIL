\ProvidesPackage{algo-activity}

\RequirePackage{graphicx}
\RequirePackage{url}
\RequirePackage{xcolor}
\RequirePackage{prettyref}
\RequirePackage{amsmath}
\RequirePackage{amsthm}
\RequirePackage{amssymb}
\RequirePackage{fancyhdr}
\RequirePackage{hyperref}
\RequirePackage{datetime}
\RequirePackage{enumitem}
\RequirePackage{xspace}
\RequirePackage[normalem]{ulem}
\RequirePackage{qrcode}
% \RequirePackage{programB}
\RequirePackage{mdframed}  % must come AFTER programB

\RequirePackage{pgf}   % seems to be incompatible with programB no matter
                       % which order I use =(
\RequirePackage{version}

\newif\ifalgoanswers\algoanswersfalse
\DeclareOption{answers}{\algoanswerstrue}

\ProcessOptions\relax

\newcommand{\theyear}{2025}
\newcommand{\theseason}{Fall}
\newcommand{\thesem}{\theseason\ \theyear}
\newcommand{\thecourse}{Algorithms}

% \newcounter{excount}
% \setcounter{excount}{0}
% \newcommand{\exercisect}[1]{
%   \refstepcounter{excount}
%   \vspace{2em}\noindent
%   {\large \textbf{\arabic{excount}#1}}
% }
% \newcommand{\exerciset}[1]{\exercisect{: #1}}
% \newcommand{\exercise}{\exercisect{}}
% \newcommand{\opt}{
%   {\large \textbf{(Optional)}}
% }
% \newcommand{\ec}{
%   {\large \textbf{(Extra Credit)}}
% }

% \newenvironment{example}{\medskip \noindent \emph{Example}: }{}
% \newenvironment{rem}{\medskip \noindent \textbf{Remark.}}{}

\graphicspath{{images/}{../../images/}{../images/}}

\newrefformat{fig}{Figure~\ref{#1}}
\newrefformat{sec}{section~\ref{#1}}
\newrefformat{eq}{equation~\eqref{#1}}
\newrefformat{prob}{Problem~\ref{#1}}
\newrefformat{tab}{Table~\ref{#1}}
\newrefformat{thm}{Theorem~\ref{#1}}
\newrefformat{lem}{Lemma~\ref{#1}}
\newrefformat{prop}{Proposition~\ref{#1}}
\newrefformat{defn}{Definition~\ref{#1}}
\newrefformat{cor}{Corollary~\ref{#1}}
\newrefformat{ex}{Exercise~\ref{#1}}
\newrefformat{alg}{Algorithm~\ref{#1}}
\newrefformat{q}{Question~\ref{#1}}
\newrefformat{model}{Model~\ref{#1}}
\newcommand{\pref}[1]{\prettyref{#1}}

% \Pref is just like \pref but it uppercases the first letter; for use
% at the beginning of a sentence.
\newcommand{\Pref}[1]{%
  \expandafter\ifx\csname r@#1\endcsname\relax {\scriptsize[ref]}
    \else
    \edef\reftext{\prettyref{#1}}\expandafter\MakeUppercase\reftext
    \fi
}

\newtheorem{thm}{Theorem}
\newtheorem{prop}[thm]{Proposition}
\newtheorem{lem}[thm]{Lemma}
\newtheorem{claim}[thm]{Claim}
\newtheorem{cor}[thm]{Corollary}
\newtheorem{alg}[thm]{Algorithm}

\theoremstyle{definition}
\newtheorem{defn}[thm]{Definition}
\newtheorem{obs}[thm]{Observation}
\newtheorem{prob}[thm]{Problem}

\theoremstyle{remark}
\newtheorem*{rem}{Remark}
\newtheorem*{ex}{Example}
\newtheorem*{nota}{Notation}

\newcommand{\term}[1]{\emph{#1}}
\newcommand{\ie}{\emph{i.e.}\xspace}
\newcommand{\eg}{\emph{e.g.}\xspace}
\newcommand{\etc}{\emph{etc.}}

\let\mlabel\label
% Problem was that tufte-latex's figure environment redefines
% the \label command to save just a single label and assign it the
% number generated by a \caption command for the whole figure.  But I
% want the figure to contain definitions and be able to label *them*.
% The solution is to just save the original definition of \label
% before the figure environment redefines it and use that.

\newenvironment{objective}%
  {\begin{lrbox}{0}\begin{minipage}{\marginparwidth}\@tufte@caption@font\textbf{Learning objective}: }%
  {\end{minipage}\end{lrbox}\marginnote{\usebox{0}\vspace{0.3in}}}

\newenvironment{pobjective}%
  {\begin{lrbox}{0}\begin{minipage}{\marginparwidth}\@tufte@caption@font\textbf{Process objective}: }%
  {\end{minipage}\end{lrbox}\marginnote{\usebox{0}\vspace{0.3in}}}

\mdfdefinestyle{modelframe}{innerleftmargin=0.7cm,innerrightmargin=0.7cm,%
  innertopmargin=0.7cm,innerbottommargin=0.7cm}

\newcounter{modelcounter}

\makeatletter
\newenvironment{@model}[3]{
  \refstepcounter{modelcounter} \label{model:#2}
  \newcommand{\@modelnewpage}{#3}
  \section{Model \themodelcounter: #1}
  \begin{figure*}[ht!]
    \begin{mdframed}[style=modelframe]
}{
    \end{mdframed}
  \end{figure*}
  \ifthenelse{\equal{\@modelnewpage}{newpage}}{\newpage}{}
}
\makeatother

\newenvironment{model}[2]{
  \begin{@model}{#1}{#2}{newpage}
}{
  \end{@model}
}

\newenvironment{model*}[2]{
  \begin{@model}{#1}{#2}{}
}{
  \end{@model}
}

\newlist{questionlist}{enumerate}{2}

\newlength{\algoitemsep}
\setlength{\algoitemsep}{8ex}

\newenvironment{answer}{\begin{mdframed}[linewidth=1pt]\itshape}{\end{mdframed}}

\ifalgoanswers
\setlength{\algoitemsep}{0pt}
\includeversion{answer}
\else
\excludeversion{answer}
\fi

\setlist[questionlist]{label=\arabic*, resume=questionlist, itemsep=\algoitemsep}

\newenvironment{questions}{
  \begin{questionlist}
}{
  \end{questionlist} \vspace{\algoitemsep}
}

\newenvironment{subquestions}{
  \begin{enumerate}[label=(\alph*), itemsep=\algoitemsep]
}{
  \end{enumerate}
}

\newcommand{\pause}{
  \vfill
  \begin{fullwidth}
    \begin{center}
      \includegraphics[width=0.5in]{STOP.pdf}
    \end{center}
  \end{fullwidth}
  \newpage
}

\newcommand{\blank}{%
  \uline{\hfill\rule[-.3\baselineskip]{0pt}{2\baselineskip}}\xspace%
}

%%% structured proofs
\newenvironment{sproof}{%
    \begin{tabbing}
    \phantom{$\equiv$} \= \qquad\qquad\qquad\qquad\qquad \= \kill
}{
    \end{tabbing}
}
\newcommand{\stmt}[1]{\> \ensuremath{#1} \\}
\newcommand{\lstmt}[1]{\> \ensuremath{#1} }
\newcommand{\reason}[2]{\ensuremath{#1} \>\> \{ \quad #2 \quad \} \\}

%% todos

% \let\oldtodo\todo
% \renewcommand{\todo}[1]{\oldtodo[inline,size=\small]{#1}}

%% title

\let\oldmaketitle\maketitle
\renewcommand{\maketitle}{\oldmaketitle\smallskip\hrule\bigskip}

%% footer

\fancyfoot[CO,CE]{\includegraphics[width=0.5in]{../CC-BY.png}
  \\ \small \copyright\ \theyear\ Brent A. Yorgey.  This work is licensed under a
  \href{http://creativecommons.org/licenses/by/4.0/}{Creative Commons
    Attribution 4.0 International License}.}

%% reflections/remarks ---------------------------------------

\newsavebox{\reflectsavebox}

\newenvironment{reflect}[1]
{
  \noindent
  \begin{lrbox}{\reflectsavebox}
    \begin{minipage}[t]{\textwidth}
      \textbf{#1}:
}{
    \end{minipage}
  \end{lrbox}
  \fbox{\usebox{\reflectsavebox}}
}
